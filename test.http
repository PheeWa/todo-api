# Variables for testing
@ALICE_TOKEN = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDEiLCJ1c2VybmFtZSI6ImFsaWNlIiwiaWF0IjoxNzY0NzQ4MzA1LCJleHAiOjE3NjUzNTMxMDV9.PmoiLicDKdEFP0K6HDzx7e89ChIPyQXShEknAvkToGs
@BOB_TOKEN = e7660d6b-dec2-4bf4-9d7e-408efab9fad7
@ALICE_TODO_ID = bdde2d1b-078d-4282-ad8f-f2d319d44557
@BOB_TODO_ID = adbd01ac-58a9-45a6-ba65-3b14efca8afe

### 1. Login as Alice
POST http://localhost:8080/login
Content-Type: application/json

{"username": "alice", "password": "admin123"}

### 2. Login as Bob
POST http://localhost:8080/login
Content-Type: application/json

{"username": "bob", "password": "user123"}

### 3a. Register new user (should return 201 with token)
POST http://localhost:8080/register
Content-Type: application/json

{"username": "charlie1", "password": "password123"}

### 3b. Register duplicate username (should return 409)
POST http://localhost:8080/register
Content-Type: application/json

{"username": "alice", "password": "newpassword"}

### 3c. Register with case-insensitive duplicate (should return 409)
POST http://localhost:8080/register
Content-Type: application/json

{"username": "ALICE", "password": "newpassword"}

### 3d. Register with username too short (should return 400)
POST http://localhost:8080/register
Content-Type: application/json

{"username": "ab", "password": "password123"}

### 3e. Register with password too short (should return 400)
POST http://localhost:8080/register
Content-Type: application/json

{"username": "validuser", "password": "12345"}

### 3f. Register valid user and use token immediately
POST http://localhost:8080/register
Content-Type: application/json

{"username": "diana2", "password": "secure123"}

### 3g. Use token from registration to create todo
POST http://localhost:8080/todos
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRpYW5hMiIsImlhdCI6MTc2NDQ5MDk3MX0.gU_qFQ3qEI1OgtCWh3TN6bmknp82-j2jboJUx6CVBoY

{"title": "Diana's first todo after registration"}

# {"username": "alice", "password": "wrongpassword"}

### 4. Alice - Create a new todo
POST http://localhost:8080/todos
Content-Type: application/json
Authorization: Bearer {{ALICE_TOKEN}}

{"title": "Alice's todo - Learning fastify"}

### 5. Alice - Get all todos
GET http://localhost:8080/todos
Authorization: Bearer {{ALICE_TOKEN}}

### 6. Alice - Create another todo
POST http://localhost:8080/todos
Content-Type: application/json
Authorization: Bearer {{ALICE_TOKEN}}

{"title": "Alice's todo - Write documentation"}

### 7. Alice - Get specific todo by ID
GET http://localhost:8080/todos/{{ALICE_TODO_ID}}
Authorization: Bearer {{ALICE_TOKEN}}

### 8. Alice - Update todo title
PATCH http://localhost:8080/todos/{{ALICE_TODO_ID}}
Content-Type: application/json
Authorization: Bearer {{ALICE_TOKEN}}

{"title": "Alice's updated todo"}

### 9. Alice - Mark todo as completed
PATCH http://localhost:8080/todos/{{ALICE_TODO_ID}}
Content-Type: application/json
Authorization: Bearer {{ALICE_TOKEN}}

{"isCompleted": true}

### 11. Alice - Delete own todo
DELETE http://localhost:8080/todos/{{ALICE_TODO_ID}}
Authorization: Bearer {{ALICE_TOKEN}}

### ========== BOB'S TESTS ==========

### 12. Bob - Get all todos (should only see own todos)
GET http://localhost:8080/todos
Authorization: Bearer {{BOB_TOKEN}}

### 13. Bob - Create a new todo
POST http://localhost:8080/todos
Content-Type: application/json
Authorization: Bearer {{BOB_TOKEN}}

{"title": "Bob's todo - Learn TypeScript"}

### 14. Bob - Get specific todo by ID
GET http://localhost:8080/todos/{{BOB_TODO_ID}}
Authorization: Bearer {{BOB_TOKEN}}

### 15. Bob - Update own todo
PATCH http://localhost:8080/todos/{{BOB_TODO_ID}}
Content-Type: application/json
Authorization: Bearer {{BOB_TOKEN}}

{"title": "Bob's updated todo"}

### 16. Bob - Delete own todo
DELETE http://localhost:8080/todos/{{BOB_TODO_ID}}
Authorization: Bearer {{BOB_TOKEN}}

### ========== OWNER-BASED AUTHORIZATION TESTS ==========

### 17. Bob tries to access Alice's todo (should return 404)
GET http://localhost:8080/todos/{{ALICE_TODO_ID}}
Authorization: Bearer {{BOB_TOKEN}}

### 18. Bob tries to update Alice's todo (should return 404)
PATCH http://localhost:8080/todos/{{ALICE_TODO_ID}}
Content-Type: application/json
Authorization: Bearer {{BOB_TOKEN}}

{"title": "Bob trying to update Alice's todo"}

### 19. Bob tries to delete Alice's todo (should return 404)
DELETE http://localhost:8080/todos/{{ALICE_TODO_ID}}
Authorization: Bearer {{BOB_TOKEN}}

### 20. Alice tries to access Bob's todo (should return 404)
GET http://localhost:8080/todos/{{BOB_TODO_ID}}
Authorization: Bearer {{ALICE_TOKEN}}

### ========== ERROR TESTS ==========

### 21. Get todos without token (should return 401)
GET http://localhost:8080/todos

### 22. Get todos with invalid token (should return 401)
GET http://localhost:8080/todos
Authorization: Bearer invalid_token_123

### 23. Create todo without token (should return 401)
POST http://localhost:8080/todos
Content-Type: application/json

{"title": "This should fail"}

### 24. Get non-existent todo (should return 404)
GET http://localhost:8080/todos/non-existent-uuid-12345
Authorization: Bearer {{ALICE_TOKEN}}

### 25. Update non-existent todo (should return 404)
PATCH http://localhost:8080/todos/non-existent-uuid-12345
Content-Type: application/json
Authorization: Bearer {{ALICE_TOKEN}}

{"title": "This should fail"}

### 26. Delete non-existent todo (should return 404)
DELETE http://localhost:8080/todos/non-existent-uuid-12345
Authorization: Bearer {{ALICE_TOKEN}}

### ========== HEALTH CHECK ==========

### 27. Health endpoint
GET http://localhost:8080/health

### 28 get user
GET http://localhost:8080/me
Authorization: Bearer {{ALICE_TOKEN}}
